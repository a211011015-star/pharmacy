import React, { createContext, useContext, useEffect, useMemo, useState } from 'react'

const I18nCtx = createContext(null)

const dict = {
  en: {
    lang:'Language',
    branch:'Branch',
    signOut:'Sign out',
    dashboard:'Dashboard',
    pos:'POS',
    purchases:'Purchases',
    products:'Products',
    inventory:'Inventory',
    scientifics:'Scientifics',
    suppliers:'Suppliers',
    transfers:'Transfers',
    timeline:'Timeline',
    reports:'Reports',
    cashClose:'Cash Close',
    users:'Users',
    settings:'Settings',
    about:'About',
    search:'Search',
    barcode:'Barcode',
    trade:'Trade',
    scientific:'Scientific',
    dosageForm:'Dosage form',
    strength:'Strength',
    per:'Per',
    cost:'Cost',
    qty:'Qty',
    total:'Total',
    exp:'EXP',
    sellingPrice:'Selling price',
    purchasePrice:'Purchase price',
    actions:'Actions',
    addRow:'Add row',
    save:'Save',
    create:'Create',
    update:'Update',
    delete:'Delete',
    addItem:'Add item',
    editItem:'Edit item',
    cancel:'Cancel',
    confirm:'Confirm',
    viewBatches:'View batches',
    invoiceInfo:'Invoice info',
    supplier:'Supplier',
    invoiceNo:'Invoice no',
    date:'Date',
    receive:'Receive',
    addNew:'Add new',
    noStrength:'No strength',
    info:'Info',
    pregnancy:'Pregnancy',
    lactation:'Lactation',
    liver:'Liver',
    kidney:'Kidney',
    interactions:'Interactions',
    severity:'Severity',
    comment:'Comment',
    warningInteraction:'Potential interaction in cart',
    currency:'Currency',
    print:'Print',
    templates:'Templates',
    purchaseA4:'Purchase A4',
    sale80:'Sale 80mm',
    openDesigner:'Open designer',
  },
  ar: {
    lang:'اللغة',
    branch:'الفرع',
    signOut:'تسجيل خروج',
    dashboard:'لوحة التحكم',
    pos:'نقطة البيع',
    purchases:'المشتريات',
    products:'الأصناف',
    inventory:'المخزن',
    scientifics:'العلميات',
    suppliers:'الموردون',
    transfers:'التحويلات',
    timeline:'الخط الزمني',
    reports:'التقارير',
    cashClose:'إغلاق الصندوق',
    users:'المستخدمون',
    settings:'الإعدادات',
    about:'حول',
    search:'بحث',
    barcode:'باركود',
    trade:'تجاري',
    scientific:'علمي',
    dosageForm:'الشكل الدوائي',
    strength:'القوة',
    per:'لكل',
    cost:'كلفة',
    qty:'كمية',
    total:'الإجمالي',
    exp:'الصلاحية',
    sellingPrice:'سعر البيع',
    purchasePrice:'سعر الشراء',
    actions:'خيارات',
    addRow:'إضافة سطر',
    save:'حفظ',
    create:'إضافة',
    update:'تعديل',
    delete:'حذف',
    addItem:'إضافة بند',
    editItem:'تعديل بند',
    cancel:'إلغاء',
    confirm:'تأكيد',
    viewBatches:'بيان الباتشات',
    invoiceInfo:'معلومات القائمة',
    supplier:'المورد',
    invoiceNo:'رقم الفاتورة',
    date:'التاريخ',
    receive:'استلام',
    addNew:'إضافة جديد',
    noStrength:'بدون قوة',
    info:'معلومات',
    pregnancy:'حمل',
    lactation:'إرضاع',
    liver:'كبد',
    kidney:'كلية',
    interactions:'تداخلات',
    severity:'الشدة',
    comment:'تعليق',
    warningInteraction:'تنبيه: تداخل محتمل في السلة',
    currency:'العملة',
    print:'الطباعة',
    templates:'القوالب',
    purchaseA4:'شراء A4',
    sale80:'مبيع 80mm',
    openDesigner:'فتح المصمم',
  },
  ku: {
    lang:'Ziman',
    branch:'Liq',
    signOut:'Derçûn',
    dashboard:'Panel',
    pos:'POS',
    purchases:'Kirin',
    products:'Products',
    inventory:'Kojbar',
    scientifics:'Scientifics',
    suppliers:'Suppliers',
    transfers:'Transfers',
    timeline:'Timeline',
    reports:'Rapor',
    cashClose:'Sanduq',
    users:'Users',
    settings:'Rêxistin',
    about:'Derbarê',
    search:'Lêgerîn',
    barcode:'Barcode',
    trade:'Trade',
    scientific:'Scientific',
    dosageForm:'Form',
    strength:'Strength',
    per:'Per',
    cost:'Cost',
    qty:'Qty',
    exp:'EXP',
    sellingPrice:'Selling price',
    purchasePrice:'Purchase price',
    actions:'Actions',
    addRow:'Add row',
    save:'Save',
    create:'Create',
    update:'Update',
    delete:'Delete',
    viewBatches:'View batches',
    invoiceInfo:'Invoice info',
    supplier:'Supplier',
    invoiceNo:'Invoice no',
    date:'Date',
    receive:'Receive',
    addNew:'Add new',
    noStrength:'No strength',
    info:'Info',
    pregnancy:'Pregnancy',
    lactation:'Lactation',
    liver:'Liver',
    kidney:'Kidney',
    interactions:'Interactions',
    severity:'Severity',
    comment:'Comment',
    warningInteraction:'Potential interaction in cart',
    currency:'Currency',
    print:'Print',
    templates:'Templates',
    purchaseA4:'Purchase A4',
    sale80:'Sale 80mm',
    openDesigner:'Open designer',
  }
}

export function I18nProvider({children}){
  const [lang,setLang]=useState(()=>localStorage.getItem('qatfah_lang') || 'ar')

  useEffect(()=>{
    localStorage.setItem('qatfah_lang', lang)
    document.documentElement.dir = (lang==='ar') ? 'rtl' : 'ltr'
    document.documentElement.lang = lang
  },[lang])

  const t = useMemo(()=>{
    const base = dict[lang] || dict.en
    return new Proxy(base, { get:(obj,prop)=> obj[prop] ?? dict.en[prop] ?? String(prop) })
  },[lang])

  const dir = (lang==='ar') ? 'rtl' : 'ltr'
  return <I18nCtx.Provider value={{lang,setLang,t,dir}}>{children}</I18nCtx.Provider>
}

export function useI18n(){
  return useContext(I18nCtx)
}
